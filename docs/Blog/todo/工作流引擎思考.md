### 关于可编排

随着各类基础设施, 尤其是Cloud Native生态的蓬勃发展, 解决问题的方式从造轮子变成了将一堆轮子搭建起来. 

devops意味着从dev转向ops, 而这种转向也带来了各种中间环节, 随之诞生了各种解决中间环节的细分领域. 例如RPA(机器人自动化流程), SOAR(安全编排与自动化响应), BAS(入侵和攻击模拟), CI/CD(持续集成/持续部署), 容器编排, serverless等等细分领域. 这些领域都有着相同的内核, 即可编排性, 对应用的自动化配置, 管理, 调度.

可编排性通常与自动化混用, 实际上也并无不可. 自动化是可编排性的超集. 

可编排性的本质是复杂的数据系统, 让我们可以只关注数据的流转, 暂时忽略数据的生成与来源. 

### 与红队相关的可编排性

BAS是为甲方设计的自动化模拟攻击的工具, 以playbook(剧本)为基础去模拟单个攻击场景.

ASM(攻击面管理)也是为甲方设计的, 以workflow(工作流)为基础去执行一系列的信息收集流程. 

这两个领域最接近可编排性在红队的落地. 不过他们从设计之初便是为了甲方解决自身的安全问题, 因此, 它们使用编排去解决复杂的流程性问题, 这一点在甲方视角来看并没有问题. 但如果作为一个红队去审视, 那就是千疮百孔, 可以很不负责任的下一个论断, BAS和ASM的上限与传统的渗透测试服务没有区别, 它们的上限是红队的下限. 

就像是为什么漏扫无论如何发展, 也还需要SRC一样. BAS解决的是安全可验证问题, ASM解决的是最低限度的攻击面管理, 红队就像是SRC之于漏扫. 

其中最关键的不在于自动化, 而在于可以被人工介入的自动化, 即交互式的自动化. 需要注意的是, 这里的交互式与IAST中的交互式不是同一个概念.  在当前环境下的红队行动中, 人脑是唯一的决策核心, 而不同的人有着完全不同的风格手法. 因此可编排在红队中的定位是辅助工具, 而非自动化工具. 

编排关注的是数据的流转, 而红队并非只是数据的流转. 即数据并不能概括红队的一切, 因此任何通过编排实现的工具都只是辅助工具.

这样的工具注定是高学习成本的, 可想像的未来都无法在甲方落地. 需要多年经验积累的职业红队去维护使用. 就像CobaltStrike在后渗透中的地位一般. 



## 选型

## prefect

缺点: 

* 不支持同时运行多个同样的subflow
* cache不支持连接到redis，需要手动实现 （已实现）
* 不支持每个task执行前后的hook。 好多代码需要用不太优雅的方式实现
* 

